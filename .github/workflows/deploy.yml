   name: D√©ployer sur GitHub Pages

   on:
     push:
       branches: [ main ]

   jobs:
     build:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v4

         - name: Installer PNPM
           uses: pnpm/action-setup@v4
           # with:
           #   version: 9.12.1  # Supprim√© pour √©viter le conflit

         - name: Utiliser Node.js
           uses: actions/setup-node@v4
           with:
             node-version: '20'
             cache: 'pnpm'

         - name: Installer les d√©pendances
           run: pnpm install

         - name: Construire le projet
           run: pnpm run build

         - name: G√©n√©rer les fichiers statiques
           run: pnpm run generate

         - name: Pr√©parer les artefacts pour le d√©ploiement
           uses: actions/upload-pages-artifact@v1
           with:
             path: './dist'

     deploy:
       needs: build
       runs-on: ubuntu-latest
       permissions:
         pages: write
         id-token: write
       steps:
         - name: üì• Checkout code
           uses: actions/checkout@v4

         - name: üõ†Ô∏è Setup Node.js
           uses: actions/setup-node@v4
           with:
             node-version: '20'

          - name: üì¶ Install dependencies
            run: npm install

          - name: üóúÔ∏è Minify JavaScript
            run: npm run minify

          - name: üìÑ Create .htaccess file
            run: |
              echo "
              <IfModule mod_expires.c>
              ExpiresActive On
              ExpiresByType image/jpg \"access plus 1 year\"
              ExpiresByType image/jpeg \"access plus 1 year\"
              ExpiresByType image/gif \"access plus 1 year\"
              ExpiresByType image/png \"access plus 1 year\"
              ExpiresByType text/css \"access plus 1 month\"
              ExpiresByType application/pdf \"access plus 1 month\"
              ExpiresByType text/x-javascript \"access plus 1 month\"
              ExpiresByType application/x-shockwave-flash \"access plus 1 month\"
              ExpiresByType image/x-icon \"access plus 1 year\"
              ExpiresDefault \"access plus 2 days\"
              </IfModule>" > .htaccess

          - name: üñºÔ∏è Prepare favicon files
            run: |
              mkdir -p favicon
              cp assets/icons/* favicon/
              ls -la favicon
              
          - name: üîÑ Synchroniser les fichiers via FTP
            uses: SamKirkland/FTP-Deploy-Action@4.3.3
            with:
              server: ${{ secrets.HOST }}
              username: ${{ secrets.USERNAME }}
              password: ${{ secrets.PASSWORD }}
              server-dir: /
              local-dir: ./
              exclude: |
                **/.git*
                **/.git*/**
                **/node_modules/**
              include: |
                favicon/**
              protocol: ftp
              port: ${{ secrets.PORT }}
              dangerous-clean-slate: true